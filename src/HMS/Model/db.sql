drop database if exists hms;
-- MySQL Script generated by MySQL Workbench
-- Wed May 25 19:12:18 2022
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering
SET @OLD_UNIQUE_CHECKS = @@UNIQUE_CHECKS, UNIQUE_CHECKS = 0;
SET @OLD_FOREIGN_KEY_CHECKS = @@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS = 0;
SET @OLD_SQL_MODE = @@SQL_MODE, SQL_MODE =
        'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema hms
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema hms
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `hms` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE `hms`;

-- -----------------------------------------------------
-- Table `hms`.`patients`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`patients`
(
    `id`          INT          NOT NULL AUTO_INCREMENT,
    `name`        VARCHAR(100) NULL DEFAULT NULL,
    `nationalID`  VARCHAR(50)  NULL DEFAULT NULL,
    `gender`      VARCHAR(50)  NULL DEFAULT NULL,
    `dateOfBirth` DATE         NULL DEFAULT NULL,
    `address`     VARCHAR(150) NULL DEFAULT NULL,
    `email`       VARCHAR(50)  NULL DEFAULT NULL,
    `phone`       VARCHAR(50)  NULL DEFAULT NULL,
    `nationality` VARCHAR(50)  NULL DEFAULT NULL,
    `marital`     VARCHAR(50)  NULL DEFAULT NULL,
    `allergies`   VARCHAR(150) NULL DEFAULT NULL,
    `bloodType`   VARCHAR(10)  NULL DEFAULT NULL,
    `birthPlace`  VARCHAR(50)  NULL DEFAULT NULL,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`facilities`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`facilities`
(
    `id`   INT         NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(50) NULL DEFAULT NULL,
    `isSP` TINYINT     NULL,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB
    AUTO_INCREMENT = 1
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`employeestypes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`employeestypes`
(
    `id`   INT         NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(50) NULL DEFAULT NULL,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB
    AUTO_INCREMENT = 1
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`employees`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`employees`
(
    `id`             INT          NOT NULL AUTO_INCREMENT,
    `name`           VARCHAR(100) NULL DEFAULT NULL,
    `enName`         VARCHAR(100) NULL DEFAULT NULL,
    `nationalID`     VARCHAR(50)  NULL DEFAULT NULL,
    `gender`         VARCHAR(50)  NULL DEFAULT NULL,
    `dateOfBirth`    DATE         NULL DEFAULT NULL,
    `address`        VARCHAR(150) NULL DEFAULT NULL,
    `email`          VARCHAR(50)  NULL DEFAULT NULL,
    `phone`          VARCHAR(50)  NULL DEFAULT NULL,
    `nationality`    VARCHAR(50)  NULL DEFAULT NULL,
    `marital`        VARCHAR(50)  NULL DEFAULT NULL,
    `degree`         VARCHAR(100) NULL DEFAULT NULL,
    `employeeTypeID` INT          NULL DEFAULT NULL,
    `facilityID`     INT          NULL DEFAULT NULL,
    `userName`       VARCHAR(50)  NULL DEFAULT NULL,
    `userPass`       VARCHAR(50)  NULL DEFAULT NULL,
    PRIMARY KEY (`id`),
    UNIQUE INDEX `userName` (`userName` ASC) VISIBLE,
    INDEX `facilityID` (`facilityID` ASC) VISIBLE,
    INDEX `employeeTypeID` (`employeeTypeID` ASC) VISIBLE,
    CONSTRAINT `employees_ibfk_1`
        FOREIGN KEY (`facilityID`)
            REFERENCES `hms`.`facilities` (`id`),
    CONSTRAINT `employees_ibfk_2`
        FOREIGN KEY (`employeeTypeID`)
            REFERENCES `hms`.`employeestypes` (`id`)
)
    ENGINE = InnoDB
    AUTO_INCREMENT = 1
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`bills`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`bills`
(
    `id`             INT  NOT NULL AUTO_INCREMENT,
    `patientID`      INT  NULL DEFAULT NULL,
    `receptionistID` INT  NULL DEFAULT NULL,
    `date`           DATE NULL DEFAULT NULL,
    `amount`         INT  NULL DEFAULT NULL,
    `paid`           INT  NULL DEFAULT 0,
    PRIMARY KEY (`id`),
    INDEX `patientID` (`patientID` ASC) VISIBLE,
    INDEX `receptionistID` (`receptionistID` ASC) VISIBLE,
    CONSTRAINT `bills_ibfk_1`
        FOREIGN KEY (`patientID`)
            REFERENCES `hms`.`patients` (`id`),
    CONSTRAINT `bills_ibfk_2`
        FOREIGN KEY (`receptionistID`)
            REFERENCES `hms`.`employees` (`id`)
)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`services`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`services`
(
    `id`         INT         NOT NULL AUTO_INCREMENT,
    `name`       VARCHAR(50) NULL DEFAULT NULL,
    `facilityID` INT         NULL DEFAULT NULL,
    `cost`       INT         NULL DEFAULT NULL,
    PRIMARY KEY (`id`),
    INDEX `facilityID` (`facilityID` ASC) VISIBLE,
    CONSTRAINT `services_ibfk_2`
        FOREIGN KEY (`facilityID`)
            REFERENCES `hms`.`facilities` (`id`)
)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`providedservices`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`providedservices`
(
    `id`           INT          NOT NULL AUTO_INCREMENT,
    `serviceID`    INT          NULL DEFAULT NULL,
    `patientID`    INT          NULL DEFAULT NULL,
    `employeeID`   INT          NULL DEFAULT NULL,
    `doctorID`     INT          NULL DEFAULT NULL,
    `facilityID`   INT          NULL DEFAULT NULL,
    `registerDate` DATE         NULL DEFAULT NULL,
    `doneDate`     DATE         NULL DEFAULT NULL,
    `notes`        VARCHAR(255) NULL DEFAULT NULL,
    `billID`       INT          NULL DEFAULT NULL,
    `cost`         INT          NULL DEFAULT NULL,
    PRIMARY KEY (`id`),
    INDEX `serviceID` (`serviceID` ASC) VISIBLE,
    INDEX `patientID` (`patientID` ASC) VISIBLE,
    INDEX `employeeID` (`employeeID` ASC) VISIBLE,
    INDEX `doctorID` (`doctorID` ASC) VISIBLE,
    INDEX `facilityID` (`facilityID` ASC) VISIBLE,
    INDEX `billID` (`billID` ASC) VISIBLE,
    CONSTRAINT `providedservices_ibfk_1`
        FOREIGN KEY (`serviceID`)
            REFERENCES `hms`.`services` (`id`),
    CONSTRAINT `providedservices_ibfk_2`
        FOREIGN KEY (`patientID`)
            REFERENCES `hms`.`patients` (`id`),
    CONSTRAINT `providedservices_ibfk_3`
        FOREIGN KEY (`employeeID`)
            REFERENCES `hms`.`employees` (`id`),
    CONSTRAINT `providedservices_ibfk_4`
        FOREIGN KEY (`doctorID`)
            REFERENCES `hms`.`employees` (`id`),
    CONSTRAINT `providedservices_ibfk_5`
        FOREIGN KEY (`facilityID`)
            REFERENCES `hms`.`facilities` (`id`),
    CONSTRAINT `providedservices_ibfk_6`
        FOREIGN KEY (`billID`)
            REFERENCES `hms`.`bills` (`id`)
)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`medicines`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`medicines`
(
    `id`    INT          NOT NULL AUTO_INCREMENT,
    `name`  VARCHAR(100) NULL DEFAULT NULL,
    `price` INT          NOT NULL,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`emergencyorders`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`emergencyorders`
(
    `id`         INT         NOT NULL AUTO_INCREMENT,
    `patientID`  INT         NULL DEFAULT NULL,
    `doctorID`   INT         NULL DEFAULT NULL,
    `facilityID` INT         NULL DEFAULT NULL,
    `visitID`    INT         NULL DEFAULT NULL,
    `date`       DATE        NULL DEFAULT NULL,
    `billID`     INT         NULL DEFAULT NULL,
    `medicineID` INT         NULL DEFAULT NULL,
    `dose`       VARCHAR(50) NULL DEFAULT NULL,
    `isDone`     TINYINT(1)  NULL DEFAULT false,
    PRIMARY KEY (`id`),
    INDEX `doctorID` (`doctorID` ASC) VISIBLE,
    INDEX `facilityID` (`facilityID` ASC) VISIBLE,
    INDEX `patientID` (`patientID` ASC) VISIBLE,
    INDEX `visitID` (`visitID` ASC) VISIBLE,
    INDEX `medicineID` (`medicineID` ASC) VISIBLE,
    CONSTRAINT `emergencyorders_ibfk_1`
        FOREIGN KEY (`doctorID`)
            REFERENCES `hms`.`employees` (`id`),
    CONSTRAINT `emergencyorders_ibfk_2`
        FOREIGN KEY (`facilityID`)
            REFERENCES `hms`.`facilities` (`id`),
    CONSTRAINT `emergencyorders_ibfk_3`
        FOREIGN KEY (`patientID`)
            REFERENCES `hms`.`patients` (`id`),
    CONSTRAINT `emergencyorders_ibfk_4`
        FOREIGN KEY (`visitID`)
            REFERENCES `hms`.`providedservices` (`id`),
    CONSTRAINT `emergencyorders_ibfk_5`
        FOREIGN KEY (`medicineID`)
            REFERENCES `hms`.`medicines` (`id`)
)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`recipes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`recipes`
(
    `id`         INT  NOT NULL AUTO_INCREMENT,
    `patientID`  INT  NULL DEFAULT NULL,
    `doctorID`   INT  NULL DEFAULT NULL,
    `facilityID` INT  NULL DEFAULT NULL,
    `visitID`    INT  NULL DEFAULT NULL,
    `date`       DATE NULL DEFAULT NULL,
    PRIMARY KEY (`id`),
    INDEX `doctorID` (`doctorID` ASC) VISIBLE,
    INDEX `facilityID` (`facilityID` ASC) VISIBLE,
    INDEX `patientID` (`patientID` ASC) VISIBLE,
    INDEX `visitID` (`visitID` ASC) VISIBLE,
    CONSTRAINT `recipes_ibfk_1`
        FOREIGN KEY (`doctorID`)
            REFERENCES `hms`.`employees` (`id`),
    CONSTRAINT `recipes_ibfk_2`
        FOREIGN KEY (`facilityID`)
            REFERENCES `hms`.`facilities` (`id`),
    CONSTRAINT `recipes_ibfk_3`
        FOREIGN KEY (`patientID`)
            REFERENCES `hms`.`patients` (`id`),
    CONSTRAINT `recipes_ibfk_4`
        FOREIGN KEY (`visitID`)
            REFERENCES `hms`.`providedservices` (`id`)
)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`recipedetails`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`recipedetails`
(
    `medicineID` INT         NULL DEFAULT NULL,
    `dose`       VARCHAR(50) NULL DEFAULT NULL,
    `recipeID`   INT         NULL DEFAULT NULL,
    INDEX `medicineID` (`medicineID` ASC) VISIBLE,
    INDEX `recipeID` (`recipeID` ASC) VISIBLE,
    CONSTRAINT `recipedetails_ibfk_1`
        FOREIGN KEY (`medicineID`)
            REFERENCES `hms`.`medicines` (`id`),
    CONSTRAINT `recipedetails_ibfk_2`
        FOREIGN KEY (`recipeID`)
            REFERENCES `hms`.`recipes` (`id`)
)
    ENGINE = InnoDB
    DEFAULT CHARACTER SET = utf8mb4
    COLLATE = utf8mb4_unicode_ci;


-- -----------------------------------------------------
-- Table `hms`.`results`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `hms`.`results`
(
    `providedServiceID` INT          NOT NULL,
    `resultFile`        MEDIUMBLOB   NOT NULL,
    `resultFileName`    VARCHAR(255) NOT NULL,
    PRIMARY KEY (`providedServiceID`),
    CONSTRAINT `providedServiceID`
        FOREIGN KEY (`providedServiceID`)
            REFERENCES `hms`.`providedservices` (`id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION
)
    ENGINE = InnoDB;


SET SQL_MODE = @OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS = @OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS = @OLD_UNIQUE_CHECKS;


/*
1,الإدارة,0
2,الاستقبال,0
3,الطوارئ,0
4,المختبر,1
5,النساء والتوليد,1
6,الطب العام,1
7,الاطفال,1
8,الباطنة,1
9,الجلدية,1
10,الاسنان,1
*/

insert into facilities (name, isSP)
VALUES ('الإدارة', FALSE);
insert into facilities (name, isSP)
VALUES ('الاستقبال', FALSE);
insert into facilities (name, isSP)
VALUES ('الطوارئ', TRUE);
insert into facilities (name, isSP)
VALUES ('المختبر', TRUE);
insert into facilities (name, isSP)
VALUES ('النساء والتوليد', TRUE);
insert into facilities (name, isSP)
VALUES ('الطب العام', TRUE);
insert into facilities (name, isSP)
VALUES ('الاطفال', TRUE);
insert into facilities (name, isSP)
VALUES ('الباطنة', TRUE);
insert into facilities (name, isSP)
VALUES ('الجلدية', TRUE);
insert into facilities (name, isSP)
VALUES ('الاسنان', TRUE);
select *
from facilities;

insert into employeestypes (name)
values ('طبيب عيادة');
insert into employeestypes (name)
values ('طبيب طوارئ');
insert into employeestypes (name)
values ('طبيب مختبر');
insert into employeestypes (name)
values ('موظف استقبال');
insert into employeestypes (name)
values ('مدير');

insert into employees (name, userName, userPass, employeeTypeID, facilityID)
values ('طبيب تجريبي', 'doc', 'doc', 1, 6);
insert into employees (name, userName, userPass, employeeTypeID, facilityID)
values ('طبيب طوارئ تجريبي', 'emerg', 'emerg', 2, 3);
insert into employees (name, userName, userPass, employeeTypeID, facilityID)
values ('طبيب مختبر تجريبي', 'lab', 'lab', 3, 4);
insert into employees (name, userName, userPass, employeeTypeID, facilityID)
values ('موظف استقبال تجريبي', 'recep', 'recep', 4, 2);
insert into employees (name, userName, userPass, employeeTypeID, facilityID)
values ('مدير تجريبي', 'admin', 'admin', 5, 1);

insert into services (name, facilityID, cost)
VALUES ('زيارة', '6', '150');
insert into services (name, facilityID, cost)
VALUES ('تحليل دم', '4', '200');
insert into services (name, facilityID, cost)
VALUES ('محلول', '3', '50');

insert into medicines (name, price)
values ('بنادول', '10');
insert into medicines (name, price)
values ('كتافلام', '20');

insert into patients (name, nationalID, gender, dateOfBirth, address, email, phone, nationality, marital, allergies,
                      bloodType, birthPlace)
VALUES ('مريض تجريبي', '21212', 'ذكر', '2020-10-10', 'تجريبي', 'تجريبي', '123123', 'مصري', 'متزوج', 'بنسلين', 'B',
        'مصر');

insert into providedservices (serviceID, patientID, doctorID, facilityID, cost)
values (1, 1, 1, 6, 100);
/*
1,الإدارة,0
2,الاستقبال,0
3,الطوارئ,0
4,المختبر,1
5,النساء والتوليد,1
6,الطب العام,1
7,الاطفال,1
8,الباطنة,1
9,الجلدية,1
10,الاسنان,1

*/
